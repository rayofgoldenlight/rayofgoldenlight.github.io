<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chain Table Website</title>
  <style>
    body {
      font-family: monospace;
      background: #f8f8f8;
      margin: 20px;
      padding: 0;
    }
    #input-box, #search-box {
      width: 90%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #chain-table {
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
      margin-bottom: 20px;
      min-height: 150px;
      white-space: pre;
      font-size: 14px;
      line-height: 22px;
    }
    .chain-row {
      display: block;
    }
    #search-results {
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      display: none;
    }
    .result-item {
      padding: 4px 6px;
      border-bottom: 1px solid #eee;
      position: relative;
    }
    .result-item:hover::after {
      content: attr(data-info);
      position: absolute;
      left: 250px;
      background: #333;
      color: #fff;
      padding: 3px 6px;
      border-radius: 4px;
      white-space: nowrap;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <input id="input-box" placeholder="Enter number and phrase (e.g. '50 double edged sword' or 'a')">
  <input id="search-box" placeholder="Search (activated with Tab key)" style="display:none;">
  
  <div id="chain-table"></div>
  <div id="search-results"></div>
  
  <script>
    let chains = [[]]; // each row is array of {pos, text}
    let searchMode = false;

    const inputBox = document.getElementById('input-box');
    const searchBox = document.getElementById('search-box');
    const chainTable = document.getElementById('chain-table');
    const searchResults = document.getElementById('search-results');

    function renderTable() {
      chainTable.innerHTML = "";
      chains.forEach(row => {
        if (row.length === 0) return;
        let rowStr = "";
        row.forEach((item, i) => {
          if (i > 0) rowStr += " ---------- ";
          rowStr += item.text;
        });
        const div = document.createElement("div");
        div.className = "chain-row";
        div.textContent = rowStr;
        chainTable.appendChild(div);
      });
    }

    function addPhrase(input) {
      if (input.trim() === "a") {
        chains.push([]);
        return;
      }
      const parts = input.trim().split(" ");
      let pos = 0;
      let phraseStart = 0;
      if (!isNaN(parseInt(parts[0]))) {
        pos = parseInt(parts[0]);
        phraseStart = 1;
      }
      const phrase = parts.slice(phraseStart).join(" ");
      const currentRow = chains[chains.length-1];
      let prevPos = currentRow.length > 0 ? currentRow[currentRow.length-1].pos : 0;
      if (currentRow.length > 0 && pos === prevPos) {
        pos = prevPos + 10; // default increment
      }
      currentRow.push({pos, text: phrase});
      renderTable();
    }

    inputBox.addEventListener('keydown', e => {
      if (e.key === "Enter") {
        addPhrase(inputBox.value);
        inputBox.value = "";
      } else if (e.key === "Tab") {
        e.preventDefault();
        searchMode = true;
        inputBox.style.display = "none";
        searchBox.style.display = "block";
        searchBox.focus();
      }
    });

    function search(query) {
      query = query.trim();
      searchResults.innerHTML = "";
      searchResults.style.display = "block";
      let results = [];
      chains.forEach(row => {
        row.forEach((item, idx) => {
          let match = false;
          if (query.startsWith(">")) {
            let val = parseInt(query.slice(1).trim());
            match = item.pos > val;
          } else if (query.startsWith("<")) {
            let val = parseInt(query.slice(1).trim());
            match = item.pos < val;
          } else if (query.startsWith("=")) {
            let val = parseInt(query.slice(1).trim());
            match = item.pos === val;
          } else {
            match = item.text.toLowerCase().includes(query.toLowerCase());
          }
          if (match) {
            let prev = idx > 0 ? row[idx-1].text : "None";
            let next = idx < row.length-1 ? row[idx+1].text : "None";
            results.push({...item, prev, next});
          }
        });
      });
      results.forEach(r => {
        let div = document.createElement("div");
        div.className = "result-item";
        div.textContent = r.text + " (pos:" + r.pos + ")";
        div.setAttribute("data-info", "Prev: " + r.prev + " | Next: " + r.next);
        searchResults.appendChild(div);
      });
    }

    searchBox.addEventListener('input', () => {
      search(searchBox.value);
    });
  </script>
</body>
</html>